<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=B6A3E523D12C9136AC9F4C02B9F5CAFF" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:FooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=59CEC968CCF63579590CF573D2095884" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Creating terriorties from Zip Code Boundaries using Bing Maps GeoData API</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Creating terriorties from Zip Code Boundaries using Bing Maps GeoData API</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            SQL Server, SQL Azure, Bing Maps, Bing Spatial Data Services
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            SQL Server, ZIP Code lookup, Bing Spatial Data Services
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop, Web, Cloud, Data, Windows RT
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">10/8/2015</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/Creating-terriorties-from-73c7ebc5">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p>Often it is useful to be able to create custom territories from existing, well known,&nbsp;boundaries. Zip Code boundaries are fairly commonly used to create sales territories. This code sample shows how to take simple&nbsp;zip code information, retrieve
 their boundaries from the Bing Maps GeoData API, combine them together to form a single shape and then generate a Well Known Text format of the shape which can easily be used in Bing Maps and other spatial tools such as SQL.</p>
<p>You can find documentation on the Bing Maps GeoData API here: <a href="https://code.msdn.microsoft.com/Creating-terriorties-from-73c7ebc5/https://msdn.microsoft.com/en-us/library/dn306801.aspx">
https://code.msdn.microsoft.com/Creating-terriorties-from-73c7ebc5/https://msdn.microsoft.com/en-us/library/dn306801.aspx</a></p>
<p>This code sample also makes use of the SQL Spatial library to do the complex task of combining the boundaries together. Note that this does not require having SQL installed. You can find this library on Nuget here:
<span style="text-decoration:underline"><span style="color:#0066cc">https://www.nuget.org/packages/Microsoft.SqlServer.Types</span></span><span style="text-decoration:underline"><span style="color:#0066cc"><br>
</span></span></p>
<h1>Building the Sample</h1>
<p>To build this sample, open the MainWindows.xaml.cs file and insert your Bing Maps key where it says &quot;Your_Bing_Maps_Key&quot;. Then press the debug button.</p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p>This code sample uses a list of zip codes to build a territory. Each zip code also has a coordinate assigned to it. This is a coordinate that is within the boundary of the zip code. If you don't have this you can easily geocode your zip code data ahead of
 time. By using coordinates with the Geodata API you reduce the need to regeocode these zip codes which would save on transactions. You can also find lists of zip codes with coordinates online fairly easily. Here is a screenshot of what this simple&nbsp;app
 looks like:</p>
<p><img id="143114" src="description/TerritoryBuilder.png" alt="" width="511" height="343"></p>
<p><strong>Tip</strong>: If you use this code with one of the Bing Maps controls either directly or via a webserivce, be sure to pas a session key from the map control to the code rather than using a hard coded Bing Maps key. This will make the requests to
 the GeoData API non-billable.</p>
<p>If you are building a web based app, you can find a well known Text importing module for Bing Maps V7 here:
<span style="text-decoration:underline"><span style="color:#0066cc">http://bingmapsv7modules.codeplex.com/wikipage?title=Well%20Known%20Text%20Reader%2fWriter</span></span><strong></strong></p>
<p>If you are building a WPF, Windows 8&#43; or Windows Phone app with Bing Maps, take a look at this library which provides an easy way to import Well Known Text into Bing Maps:
<a href="http://mapstoolbox.codeplex.com">http://mapstoolbox.codeplex.com</a></p>

</div>


    </div>
</body>
</html>
