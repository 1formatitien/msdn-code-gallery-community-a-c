<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/a7d1e078-8570-47da-a87b-ff462dfc958dCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>ASP.NET MVC 5 - Connect with Azure SQLServer Database</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>ASP.NET MVC 5 - Connect with Azure SQLServer Database</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            C#, Microsoft Azure, ASP.NET MVC, SQL Azure, ASP.NET MVC 5, MVC5
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            C#, Microsoft Azure, ASP.NET MVC, SQL Azure
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Web, Cloud, Data
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">4/23/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/ASPNET-MVC-connect-with-1f40770f">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<p lang="en-US"><span style="font-size:small"><strong>Introduction</strong></span></p>
<p lang="en-US">Using MVC, Entity Framework, ASP.NET Scaffolding, and Azure SQLServer you can create a web application that stores your information on an SQL Azure database. This demo shows you how to create a web application with MVC and Entity Framework 6,
 that communicate with a SQL Azure database.</p>
<p lang="en-US">&nbsp;</p>
<p lang="en-US"><span style="font-size:small"><strong>STEP 1 - Create Azure Account</strong></span></p>
<p lang="en-US">You need to get a Windows Azure account. Everyone can open a Windows Azure account for free.</p>
<p lang="en-US">Check the link below for more information.</p>
<p lang="en-US"><a href="http://www.windowsazure.com/en-us/pricing/free-trial/">http://www.windowsazure.com/en-us/pricing/free-trial/
</a></p>
<p>&nbsp;</p>
<p lang="en-US"><span style="font-size:small"><strong>STEP 2 - Create SQL Database on Windows Azure</strong></span></p>
<p lang="en-US">After get access to an Azure Account, we need to create a SQL Database to store your data.</p>
<p lang="en-US">So for that we need to select the option New on the left bottom of our web page and then select the option Data Services -&gt; SQL Database-&gt; Quick Create and give a name to your SQL Database and provide credentials.</p>
<p lang="en-US">On this case our SQL Database will have the name &quot;MVCDemo&quot;.</p>
<p><img id="113355" src="description/1.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto"></p>
<p lang="en-US"><img id="113356" src="description/2.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto"></p>
<p lang="en-US">After created the SQL Database, we need to get the connection string that will be used on Web Aplication to access the Azure SQL Database.</p>
<p>For that, select the databse cretaed and on the main window, on the right side, we have an option called &quot;Show Connection String&quot;.</p>
<p>When we select that option, a new window will appear, like the following image, with the connection string formatted to different providers.</p>
<p><img id="113357" src="description/3.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto"></p>
<p>&nbsp;</p>
<p lang="en-US"><strong><span style="font-size:small">STEP 3 - Create ASP.NET Web Application</span></strong></p>
<p lang="en-US">I will be using Visual Studio 2013 as my development environment. Our first step will be to create an ASP.NET Web Application.</p>
<ul type="disc">
<li lang="en-US"><span>Open Visual Studio 2013 and create a new project of type ASP.NET Web Application.</span>
</li><li lang="en-US"><span>On this project I create a solution called MVCDemoAzureSQLServer.</span>
</li></ul>
<p><span style="white-space:pre"><img id="113358" src="description/4.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto">
</span>&nbsp;&nbsp;</p>
<ul type="disc">
<li><span>Press OK, and a new screen will appear, with several options of template to use on our project.</span>
</li><li><span>Select the option MVC.</span> </li></ul>
<p><img id="113359" src="description/5.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto"></p>
<p>&nbsp;</p>
<p><span style="font-size:small"><strong>STEP 4 - Create Data Model</strong></span></p>
<p lang="en-US">After we have our web application created, we need to ceate our data model.</p>
<p>For that, select the option Add New Item on solution and choose the option ADO.NET Entity Data Model.</p>
<p>On this sample, we call it DataModel.edmx.</p>
<p><img id="113360" src="description/6.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto">&nbsp;</p>
<p>After we select this component, a configuration wizard will appear.</p>
<p>On the first screen, we need to choose model contents. Two options will be available:</p>
<ol type="1">
<li><span>Generate from database </span></li><li><span>Empty Model</span> </li></ol>
<p><img id="113361" src="description/7.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto">&nbsp;</p>
<p><span>By selecting&nbsp;</span><span>Generate from database</span><span>, you can generate an .edmx file from an existing database. In the next steps, the Entity Data Model Wizard will guide you through selecting a data source, database, and database objects
 to include in the conceptual model.</span></p>
<p><span>By selecting&nbsp;</span><span>Empty model</span><span>, you can add an .edmx file that contains empty conceptual model, storage model, and mapping sections to your project. Select this option if you plan to use the Entity Designer to build your conceptual
 model and later generate a database that supports the model. </span></p>
<p><span>On this sample, we select the first one.</span></p>
<p><img id="113362" src="description/8.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto"></p>
<p>On the next screen, we need to select the Data Connection.</p>
<p>Select the option New Connection and paste the information existent on STEP2 to ADO.NET provider.</p>
<p>The database will be filled with the name of our Azure SQL Database.</p>
<p>On this moment we have our empty .edmx file created with the correct connection string to our Azure SQL Database.</p>
<p>So, lets add some entities to our model.</p>
<p>On the DataModel.edmx diagram select the option Add New -&gt; Entity</p>
<p><img id="113363" src="description/9.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto">&nbsp;</p>
<p>Create two entities like the existent on the next image.</p>
<p><img id="113364" src="description/10.png" alt="" width="498" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto">&nbsp;</p>
<p>Select the option Generate Dabase from Model.</p>
<p>This option, will generate a SQL script. Execute the script in your sql database.</p>
<p><img id="113365" src="description/11.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto"></p>
<p>Right now, we have our Azure SQL Database created, and our web application with the connection to it.</p>
<p>Lets create our web application controllers and views.</p>
<p>&nbsp;</p>
<p lang="en-US"><strong><span style="font-size:small">STEP 5 - Scaffolding</span></strong></p>
<p><span lang="pt">This could be made </span><span lang="en-US">easily</span><span lang="pt"> using the Scaffolding functionality.</span></p>
<p>On the solution, select the option Add New Scaffolded Item like on the image below.</p>
<p><img id="113366" src="description/12.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto">&nbsp;</p>
<p>On the new screen, select the option MVC5 Controller with views using entity framework.</p>
<p><img id="113367" src="description/13.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto">&nbsp;</p>
<p>Select the name of the controller, class model and data context class.</p>
<p><img id="113368" src="description/14.png" alt="" width="600" height="425" style="display:block; margin-left:auto; margin-right:auto">&nbsp;</p>
<p>Do the same to the other entity (Model)</p>
<p>The two new controllers and views associated, were created with sucess.</p>
<p><img id="113369" src="description/15.png" alt="" width="287" height="526" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>&nbsp;</p>
<p lang="en-US"><strong><span style="font-size:small">STEP 6 - Change Menu Layout</span></strong></p>
<p lang="en-US">To test the two tables, we can add two new entries on the web application menu.</p>
<p><img id="113370" src="description/16.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto"></p>
<p>&nbsp;</p>
<p lang="en-US"><strong><span style="font-size:small">STEP 7 - Run Application</span></strong></p>
<p>Press now the F5 button, to run the web application.</p>
<p>The new entities appear on the menu.</p>
<p><img id="113371" src="description/17.png" alt="" width="600" height="400" style="vertical-align:middle; display:block; margin-left:auto; margin-right:auto">Select the first one and add, new brands.</p>
<p><img id="113372" src="description/18.png" alt="" width="600" height="400" style="vertical-align:middle"></p>
<p>Select the second one, and check that the brands created, appear on the create view, to associate model to a existent car.</p>
<p><img id="113374" src="description/19.png" alt="" width="570" height="440" style="display:block; margin-left:auto; margin-right:auto"></p>

</div>


    </div>
</body>
</html>
