<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps;/Areas/Centers/Themes/StandardDevCenter/Content:0&amp;amp;v=15CA4F640FE303BB139D3B851A140E56" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:NewFooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=90EAE36970292C42654B7D481764CD4E" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Azure App Services - Send an Email</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Azure App Services - Send an Email</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Azure, Windows Azure Web Sites
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            C#, Azure, Windows Azure Web Sites
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">1/25/2016</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MIT</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/Azure-App-Service-Web-App-02821bb1">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p><em>There are numerous ways to send emails from an Azure App Server (Web App) for example using SendGrid from the market place or sending an email using your O365 SMTP server.&nbsp;</em></p>
<p><em>A point to consider when sending emails from an App Service is that if you send spam or to many emails, then the IP address of your App will be blacklisted and it will shutdown your App.&nbsp; So do not use an Azure Web App to send spam or bulk emails.</em></p>
<p><em>See More Information for 2 articles I wrote about sending emails from Azure App Services.<br>
</em></p>
<h1><span>Building the Sample</span></h1>
<p><em>Unzip the code and open the solution.&nbsp; There are 3 places where you need to modify the code to make it work for you.&nbsp;
</em></p>
<p><em>&nbsp;</em></p>
<p><em>&nbsp;</em></p>
<p><em>&nbsp;</em></p>
<p><em></p>
<ol>
<li>Replace existing content with&nbsp;your email address and name on line 14. </li><li>Replace existing content with a 'from' email address and name on line 15. </li><li>Replace existing content with your O365 user id and password on line 22.&nbsp; You might consider placing these in a configuration file and accessing them via code instead of hard coding them.
</li></ol>
</em>
<p></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p><em>Use the <a class="libraryLink" href="https://code.msdn.microsoft.com/Azure-App-Service-Web-App-02821bb1/https://msdn.microsoft.com/en-US/library/System.Net.Mail.aspx"  title="Auto generated link to System.Net.Mail">System.Net.Mail</a> namespace to run&nbsp;access and send emails from your&nbsp;Azure App&nbsp;Service.&nbsp;&nbsp;</em></p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">MailMessage msg = new MailMessage();
msg.To.Add(new MailAddress(&quot;TO&quot;, &quot;Benjamin&quot;));
msg.From = new MailAddress(&quot;From&quot;, &quot;You&quot;);
msg.Subject = &quot;Azure Web App Email&quot;;
msg.Body = &quot;Test message from a Web App&quot;;
msg.IsBodyHtml = true;
SmtpClient client = new SmtpClient();
client.UseDefaultCredentials = false;
client.Credentials = new <a class="libraryLink" href="https://code.msdn.microsoft.com/Azure-App-Service-Web-App-02821bb1/https://code.msdn.microsoft.com/Azure-App-Service-Web-App-02821bb1/https://msdn.microsoft.com/en-US/library/System.Net.NetworkCredential.aspx"  title="Auto generated link to System.Net.NetworkCredential">System.Net.NetworkCredential</a>(&quot;UID&quot;, &quot;PASS&quot;);
client.Port = 587;
client.Host = &quot;smtp.office365.com&quot;;</pre>
<div class="preview">
<pre class="csharp">MailMessage&nbsp;msg&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;MailMessage();&nbsp;
msg.To.Add(<span class="cs__keyword">new</span>&nbsp;MailAddress(<span class="cs__string">&quot;TO&quot;</span>,&nbsp;<span class="cs__string">&quot;Benjamin&quot;</span>));&nbsp;
msg.From&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;MailAddress(<span class="cs__string">&quot;From&quot;</span>,&nbsp;<span class="cs__string">&quot;You&quot;</span>);&nbsp;
msg.Subject&nbsp;=&nbsp;<span class="cs__string">&quot;Azure&nbsp;Web&nbsp;App&nbsp;Email&quot;</span>;&nbsp;
msg.Body&nbsp;=&nbsp;<span class="cs__string">&quot;Test&nbsp;message&nbsp;from&nbsp;a&nbsp;Web&nbsp;App&quot;</span>;&nbsp;
msg.IsBodyHtml&nbsp;=&nbsp;<span class="cs__keyword">true</span>;&nbsp;
SmtpClient&nbsp;client&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;SmtpClient();&nbsp;
client.UseDefaultCredentials&nbsp;=&nbsp;<span class="cs__keyword">false</span>;&nbsp;
client.Credentials&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;<a class="libraryLink" href="https://code.msdn.microsoft.com/Azure-App-Service-Web-App-02821bb1/https://code.msdn.microsoft.com/Azure-App-Service-Web-App-02821bb1/https://msdn.microsoft.com/en-US/library/System.Net.NetworkCredential.aspx"  title="Auto generated link to System.Net.NetworkCredential">System.Net.NetworkCredential</a>(<span class="cs__string">&quot;UID&quot;</span>,&nbsp;<span class="cs__string">&quot;PASS&quot;</span>);&nbsp;
client.Port&nbsp;=&nbsp;<span class="cs__number">587</span>;&nbsp;
client.Host&nbsp;=&nbsp;<span class="cs__string">&quot;smtp.office365.com&quot;</span>;</pre>
</div>
</div>
</div>
<h1><span>Source Code Files</span></h1>
<ul>
<li><em>default.aspx -&nbsp;contains a label to display if the email was sent ok or not.</em>
</li><li><em><em>default.aspx.cs - contains the source to send an email from an Azure App Service.</em></em>
</li><li><em>web.config - contains the default ASP.NET web site configurations for 4.6</em>
</li></ul>
<h1>More Information</h1>
<p><em>For more information on sending emails see these posts:</em></p>
<p><em>&nbsp;</em></p>
<p><em>&nbsp;</em></p>
<p><em>&nbsp;</em></p>
<p><em></p>
<ul>
<li>Sending emails using Send Grid from an Azure Web App -&gt; <a href="http://blogs.msdn.com/b/benjaminperkins/archive/2015/02/02/sending-an-email-from-azure-websites-using-sendgrid.aspx">
http://blogs.msdn.com/b/benjaminperkins/archive/2015/02/02/sending-an-email-from-azure-websites-using-sendgrid.aspx</a>
</li><li>Sending emails using O365 SMTP Exchange Online -&gt; <a href="http://blogs.msdn.com/b/waws/archive/2015/10/09/sending-email-from-an-azure-web-app-using-an-O365-smtp-server.aspx">
http://blogs.msdn.com/b/waws/archive/2015/10/09/sending-email-from-an-azure-web-app-using-an-O365-smtp-server.aspx</a>
</li></ul>
</em>
<p></p>

</div>


    </div>
</body>
</html>
